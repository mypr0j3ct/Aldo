<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Masuk</title>
    <script type="module" src="./config-sdk.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }
        
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.1"/><circle cx="50" cy="10" r="0.5" fill="white" opacity="0.1"/><circle cx="20" cy="80" r="0.5" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            pointer-events: none;
        }
        
        .login-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.1),
                0 0 0 1px rgba(255, 255, 255, 0.1) inset;
            width: 100%;
            max-width: 420px;
            text-align: center;
            position: relative;
        }
        
        .logo-container {
            margin-bottom: 30px;
        }
        
        .lock-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 16px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }
        
        .login-container h2 {
            margin-bottom: 8px;
            color: #1a1a1a;
            font-size: 28px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        .subtitle {
            color: #666;
            font-size: 14px;
            margin-bottom: 32px;
            font-weight: 400;
        }
        
        .input-group {
            position: relative;
            margin-bottom: 20px;
        }
        
        .input-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            z-index: 2;
        }
        
        input[type="email"], input[type="password"], input[type="text"] {
            width: 100%;
            padding: 16px 16px 16px 48px;
            border: 2px solid #e8e8e8;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 500;
            background: #fafafa;
            transition: all 0.3s ease;
            color: #1a1a1a;
        }
        
        input[type="email"]:focus, input[type="password"]:focus, input[type="text"]:focus {
            border-color: #667eea;
            background: #ffffff;
            outline: none;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }
        
        input::placeholder {
            color: #999;
            font-weight: 400;
        }
        
        .password-wrapper {
            position: relative;
        }
        
        .password-wrapper .toggle-password {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: all 0.2s ease;
            z-index: 2;
        }
        
        .password-wrapper .toggle-password:hover {
            background: rgba(102, 126, 234, 0.1);
        }
        
        button[type="submit"] {
            width: 100%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            margin-top: 8px;
        }
        
        button[type="submit"]:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        button[type="submit"]:active {
            transform: translateY(0);
        }
        
        p {
            margin-top: 24px;
            font-size: 14px;
            color: #666;
        }
        
        a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            transition: color 0.2s ease;
        }
        
        a:hover {
            color: #764ba2;
            text-decoration: underline;
        }

        .user-icon { 
            width: 56px;
            height: 56px;
            margin: 0 auto 12px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 18px rgba(102, 126, 234, 0.3);
        }
        
        @media (max-width: 480px) {
            body {
                padding: 10px; 
            }
            .login-container {
                padding: 25px 15px; 
                margin: 10px;     
            }
            
            .login-container h2 {
                font-size: 22px; 
            }

            .subtitle {
                font-size: 13px;   
                margin-bottom: 25px; 
            }

            input[type="email"], input[type="password"], input[type="text"] {
                padding: 14px 14px 14px 40px; 
                font-size: 15px;             
            }

            .input-icon {
                left: 12px; 
            }
            
            button[type="submit"] {
                padding: 14px;    
                font-size: 15px; 
            }

            p {
                font-size: 13px;    
                margin-top: 20px;  
            }
            
            .logo-container {
                margin-bottom: 25px; 
            }

            .lock-icon {
                width: 56px;         
                height: 56px;        
                margin: 0 auto 12px; 
            }

            .lock-icon svg {
                width: 28px;        
                height: 28px;       
            }
        }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="logo-container">
            <div class="user-icon"> <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M16 7C16 9.20914 14.2091 11 12 11C9.79086 11 8 9.20914 8 7C8 4.79086 9.79086 3 12 3C14.2091 3 16 4.79086 16 7Z" fill="white"/>
                    <path d="M12 14C8.13401 14 5 17.134 5 21H19C19 17.134 15.866 14 12 14Z" fill="white"/>
                </svg>
            </div>
            <h2>Selamat Datang</h2>
            <p class="subtitle">Masuk ke akun Anda untuk melanjutkan</p>
        </div>
        
        <form id="loginForm">
            <div class="input-group">
                <div class="input-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 12.75C13.63 12.75 15.07 13.14 16.24 13.65C17.32 14.13 18 15.21 18 16.38V17C18 17.55 17.55 18 17 18H7C6.45 18 6 17.55 6 17V16.39C6 15.21 6.68 14.13 7.76 13.66C8.93 13.14 10.37 12.75 12 12.75ZM4 13C5.1 13 6 12.1 6 11C6 9.9 5.1 9 4 9C2.9 9 2 9.9 2 11C2 12.1 2.9 13 4 13ZM5.13 14.1C4.76 14.04 4.39 14 4 14C3.01 14 2.07 14.21 1.22 14.58C0.48 14.9 0 15.62 0 16.43V17C0 17.55 0.45 18 1 18H4.5V16.39C4.5 15.56 4.73 14.78 5.13 14.1ZM20 13C21.1 13 22 12.1 22 11C22 9.9 21.1 9 20 9C18.9 9 18 9.9 18 11C18 12.1 18.9 13 20 13ZM24 16.43C24 15.62 23.52 14.9 22.78 14.58C21.93 14.21 20.99 14 20 14C19.61 14 19.24 14.04 18.87 14.1C19.27 14.78 19.5 15.56 19.5 16.39V18H23C23.55 18 24 17.55 24 17V16.43ZM12 6C13.66 6 15 7.34 15 9C15 10.66 13.66 12 12 12C10.34 12 9 10.66 9 9C9 7.34 10.34 6 12 6Z" fill="#999"/>
                    </svg>
                </div>
                <input type="email" id="email" placeholder="Alamat Email" required>
            </div>
            
            <div class="input-group">
                <div class="password-wrapper">
                    <div class="input-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 2C10.3431 2 9 3.34315 9 5V7H7C5.89543 7 5 7.89543 5 9V19C5 20.1046 5.89543 21 7 21H17C18.1046 21 19 20.1046 19 19V9C19 7.89543 18.1046 7 17 7H15V5C15 3.34315 13.6569 2 12 2ZM13 7V5C13 4.44772 12.5523 4 12 4C11.4477 4 11 4.44772 11 5V7H13Z" fill="#999"/>
                        </svg>
                    </div>
                    <input type="password" id="password" placeholder="Kata Sandi" required>
                    <div class="toggle-password" id="togglePassword">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 4.5C7 4.5 2.73 7.61 1 12C2.73 16.39 7 19.5 12 19.5S21.27 16.39 23 12C21.27 7.61 17 4.5 12 4.5ZM12 17C9.24 17 7 14.76 7 12S9.24 7 12 7S17 9.24 17 12S14.76 17 12 17ZM12 9C10.34 9 9 10.34 9 12S10.34 15 12 15S15 13.66 15 12S13.66 9 12 9Z" fill="#667eea"/>
                        </svg>
                    </div>
                </div>
            </div>
            
            <button type="submit">Masuk ke Akun</button>
        </form>
        
        <p>Belum punya akun? <a href="daftar.html">Daftar sekarang</a></p>
    </div>
    
    <script type="module">
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-database.js";
        import { app } from "./config-sdk.js";
        const db = getDatabase(app);
        const loginForm = document.getElementById('loginForm');

        if (localStorage.getItem('isLoggedIn') === 'true') {
            if (localStorage.getItem('username') === 'Super Admin') {
                location.replace('admin.html');
            } else {
                location.replace('index.html');
            }
        }

        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const emailKey = email.replace(/[.#$[\]]/g, '_');
            const userRef = ref(db, `users/${emailKey}`);

            onValue(userRef, (snapshot) => {
                if (snapshot.exists()) {
                    const userData = snapshot.val();
                    if (userData.password === password) {
                        localStorage.setItem('isLoggedIn', 'true');
                        localStorage.setItem('username', userData.username);
                        localStorage.setItem('idmicro', userData.idmicro);

                        if (userData.username === "Super Admin") {
                            location.replace('admin.html');
                        } else {
                            location.replace('index.html');
                        }
                    } else {
                        alert('Password salah.');
                    }
                } else {
                    alert('User tidak ditemukan.');
                }
            }, {
                onlyOnce: true
            });
        });

        const togglePassword = document.getElementById('togglePassword');
        const passwordInput = document.getElementById('password');
        togglePassword.addEventListener('click', () => {
            const isPassword = passwordInput.type === 'password';
            passwordInput.type = isPassword ? 'text' : 'password';
            togglePassword.innerHTML = isPassword ? 
                `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 7C9.24 7 7 9.24 7 12S9.24 17 12 17S17 14.76 17 12S14.76 7 12 7ZM12 15C10.34 15 9 13.66 9 12S10.34 9 12 9S15 10.34 15 12S13.66 15 12 15Z" fill="#667eea"/>
                    <path d="M1 12C2.73 7.61 7 4.5 12 4.5S21.27 7.61 23 12L20.05 12.74L17.31 10L12 4.5L6.69 10L3.95 12.74L1 12Z" fill="#667eea"/>
                    <path d="M3 3L21 21L19.59 22.41L17.17 20L15.59 18.41C14.5 18.78 13.28 19 12 19.5C7 19.5 2.73 16.39 1 12C1.13 11.7 1.26 11.4 1.41 11.11L3 3Z" fill="#667eea"/>
                </svg>` :
                `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 4.5C7 4.5 2.73 7.61 1 12C2.73 16.39 7 19.5 12 19.5S21.27 16.39 23 12C21.27 7.61 17 4.5 12 4.5ZM12 17C9.24 17 7 14.76 7 12S9.24 7 12 7S17 9.24 17 12S14.76 17 12 17ZM12 9C10.34 9 9 10.34 9 12S10.34 15 12 15S15 13.66 15 12S13.66 9 12 9Z" fill="#667eea"/>
                </svg>`;
        });
    </script>
</body>
</html>
